#!/usr/bin/env perl
use strict;
use warnings;

# <- Leading comments are for documentation only
#
# #===================#
# Project: Foo
# #===================#
#
# Start-date1
#   - What was done
#   - Another task
# End-date1
#   = 123 min
#
# Start-date2
#   - Yet another task
# End-date2
#   = 42 min
#
# ...

use Data::Dumper::Compact 'ddc';
#use DateTime::Format::Natural;

my $file = shift || die "Usage: perl $0 /some/work/log.txt\n";

my %projects;
my $project;

open my $fh, '<', $file or die "Can't read $file: $!";

while (my $line = readline($fh)) {
    next if $line =~ /^#/;
    chomp $line;
    next unless $line;
    if ($line =~ /^Project: (.+)$/) {
        $project = $1;
    }
#    elsif ($line =~ /^([A-Z].+)$/) {
#    }
    elsif ($line =~ /^\s+= (\d+) min/) {
        $projects{$project} += $1;
    }
}
#warn(__PACKAGE__,' ',__LINE__," MARK: ",ddc(\%projects));

close $fh or die "Can't close $file: $!";

for $project (sort keys %projects) {
    printf "%s: %.2f\n", $project, $projects{$project} / 60;
}
